@extends('layouts.app')

@section('content')
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        
        <!-- Mobile Header -->
        <div class="mb-6 animate-fade-in">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">{{ $recipe['name'] }}</h1>
                    <div class="flex flex-wrap items-center space-x-4 text-sm text-gray-600">
                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            <span>{{ $isFrench ? 'Généré par Sherlock Recette' : 'Generated by Sherlock Recipe' }}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>{{ now()->format('d/m/Y H:i') }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 animate-fade-in delay-100">
                    <button onclick="window.print()" 
                            class="bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                        </svg>
                        <span>{{ $isFrench ? 'Imprimer' : 'Print' }}</span>
                    </button>
                    @include('buttons')
                </div>
            </div>
        </div>

        <!-- Recipe Card -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden animate-scale-in">
            <!-- Header -->
            <div class="bg-gradient-to-r from-indigo-600 to-blue-500 px-6 py-6">
                <h2 class="text-xl md:text-2xl font-bold text-white">{{ $recipe['name'] }} - {{ $recipe['category'] }}</h2>
                <p class="text-indigo-100 mt-2">
                    {{ $isFrench ? 'Quantité' : 'Quantity' }}: {{ $recipe['yield_quantity'] }}
                </p>
            </div>
            
            <!-- Info Bar -->
            <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-4 border-b border-gray-200">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    @if(isset($recipe['preparation_time']))
                    <div class="flex items-center justify-center md:justify-start">
                        <div class="flex items-center space-x-2 text-center md:text-left">
                            <div class="bg-blue-100 rounded-full p-2">
                                <svg class="h-4 w-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">{{ $isFrench ? 'Préparation' : 'Preparation' }}</p>
                                <p class="text-sm font-medium text-gray-900">{{ $recipe['preparation_time'] ?? '--' }} min</p>
                            </div>
                        </div>
                    </div>
                    @endif
                    
                    @if(isset($recipe['cooking_time']))
                    <div class="flex items-center justify-center md:justify-start">
                        <div class="flex items-center space-x-2 text-center md:text-left">
                            <div class="bg-orange-100 rounded-full p-2">
                                <svg class="h-4 w-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">{{ $isFrench ? 'Cuisson' : 'Cooking' }}</p>
                                <p class="text-sm font-medium text-gray-900">{{ $recipe['cooking_time'] ?? '--' }} min</p>
                            </div>
                        </div>
                    </div>
                    @endif
                    
                    @if(isset($recipe['rest_time']))
                    <div class="flex items-center justify-center md:justify-start">
                        <div class="flex items-center space-x-2 text-center md:text-left">
                            <div class="bg-green-100 rounded-full p-2">
                                <svg class="h-4 w-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">{{ $isFrench ? 'Repos' : 'Rest' }}</p>
                                <p class="text-sm font-medium text-gray-900">{{ $recipe['rest_time'] ?? '--' }} min</p>
                            </div>
                        </div>
                    </div>
                    @endif
                    
                    <div class="flex items-center justify-center md:justify-start">
                        <div class="flex items-center space-x-2 text-center md:text-left">
                            <div class="bg-purple-100 rounded-full p-2">
                                <svg class="h-4 w-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">{{ $isFrench ? 'Difficulté' : 'Difficulty' }}</p>
                                <p class="text-sm font-medium text-gray-900">{{ ucfirst($recipe['difficulty_level'] ?? ($isFrench ? 'Moyenne' : 'Medium')) }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-6">
                <!-- Ingredients -->
                <div class="mb-8 animate-fade-in-up" style="animation-delay: 0.2s">
                    <h3 class="text-lg md:text-xl font-medium text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        {{ $isFrench ? 'Ingrédients' : 'Ingredients' }}
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        @foreach ($recipe['ingredients'] as $ingredient)
                            <div class="flex items-start bg-gray-50 rounded-lg p-3 hover:bg-gray-100 transition-colors duration-200">
                                <span class="flex-shrink-0 w-3 h-3 bg-indigo-400 rounded-full mt-1.5 mr-3"></span>
                                <div class="flex-1">
                                    <span class="font-medium text-gray-900">{{ $ingredient['quantity'] }} {{ $ingredient['unit'] }}</span>
                                    <span class="mx-1 text-gray-500">{{ $isFrench ? 'de' : 'of' }}</span>
                                    <span class="text-gray-800">{{ $ingredient['name'] }}</span>
                                    @if(!empty($ingredient['notes']))
                                        <div class="text-sm text-gray-500 mt-1">({{ $ingredient['notes'] }})</div>
                                    @endif
                                </div>
                            </div>
                        @endforeach
                    </div>
                </div>
                
                <!-- Steps -->
                <div class="mb-8 animate-fade-in-up" style="animation-delay: 0.3s">
                    <h3 class="text-lg md:text-xl font-medium text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                        {{ $isFrench ? 'Étapes de préparation' : 'Preparation steps' }}
                    </h3>
                    <div class="space-y-4">
                        @foreach ($recipe['steps'] as $step)
                            <div class="flex">
                                <div class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-full bg-indigo-100 text-indigo-800 font-medium text-sm mr-4 mt-1">
                                    {{ $step['number'] }}
                                </div>
                                <div class="flex-1 bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200">
                                    <p class="text-gray-800 leading-relaxed">{{ $step['instruction'] }}</p>
                                    @if(isset($step['time']) && $step['time'])
                                        <div class="mt-2 flex items-center text-sm text-gray-500">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            {{ $isFrench ? 'Temps' : 'Time' }}: {{ $isFrench ? 'environ' : 'about' }} {{ $step['time'] }} {{ $isFrench ? 'minutes' : 'minutes' }}
                                        </div>
                                    @endif
                                </div>
                            </div>
                        @endforeach
                    </div>
                </div>
                
                <!-- Notes -->
                @if(!empty($recipe['notes']))
                <div class="animate-fade-in-up" style="animation-delay: 0.4s">
                    <h3 class="text-lg md:text-xl font-medium text-gray-900 mb-4 pb-2 border-b border-gray-200 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        {{ $isFrench ? 'Notes et conseils' : 'Notes and tips' }}
                    </h3>
                    <div class="bg-amber-50 p-4 rounded-lg border border-amber-200">
                        <div class="space-y-2 text-gray-800">
                            @foreach ($recipe['notes'] as $note)
                                <div class="flex items-start">
                                    <span class="flex-shrink-0 text-amber-500 mr-2 mt-1">💡</span>
                                    <span class="text-sm leading-relaxed">{{ $note }}</span>
                                </div>
                            @endforeach
                        </div>
                    </div>
                </div>
                @endif
            </div>
            
            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center space-y-3 md:space-y-0">
                <div class="text-sm text-gray-500 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    {{ $isFrench ? 'Généré par Sherlock Recette' : 'Generated by Sherlock Recipe' }}
                </div>
                
                @auth
                <form action="{{ route('sherlock.recipes.save') }}" method="POST" class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2">
                    @csrf
                    <input type="hidden" name="name" value="{{ $recipe['name'] }}">
                    <input type="hidden" name="category_id" value="1">
                    <input type="hidden" name="description" value="{{ $isFrench ? 'Recette générée par Sherlock Recette' : 'Recipe generated by Sherlock Recipe' }}">
                    <input type="hidden" name="preparation_time" value="{{ $recipe['preparation_time'] ?? '' }}">
                    <input type="hidden" name="cooking_time" value="{{ $recipe['cooking_time'] ?? '' }}">
                    <input type="hidden" name="rest_time" value="{{ $recipe['rest_time'] ?? '' }}">
                    <input type="hidden" name="yield_quantity" value="{{ $recipe['yield_quantity'] ?? 1 }}">
                    <input type="hidden" name="difficulty_level" value="{{ $recipe['difficulty_level'] ?? 'moyen' }}">
                    
                    @foreach ($recipe['ingredients'] as $index => $ingredient)
                        <input type="hidden" name="ingredients[{{ $index }}][name]" value="{{ $ingredient['name'] }}">
                        <input type="hidden" name="ingredients[{{ $index }}][quantity]" value="{{ $ingredient['quantity'] }}">
                        <input type="hidden" name="ingredients[{{ $index }}][unit]" value="{{ $ingredient['unit'] }}">
                        <input type="hidden" name="ingredients[{{ $index }}][notes]" value="{{ $ingredient['notes'] ?? '' }}">
                    @endforeach
                    
                    @foreach ($recipe['steps'] as $index => $step)
                        <input type="hidden" name="steps[{{ $index }}][instruction]" value="{{ $step['instruction'] }}">
                        <input type="hidden" name="steps[{{ $index }}][time_required]" value="{{ $step['time'] ?? '' }}">
                    @endforeach
                    
                    <button type="submit" 
                            class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 transform hover:scale-105">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                        </svg>
                        {{ $isFrench ? 'Enregistrer cette recette' : 'Save this recipe' }}
                    </button>
                </form>
                @endauth
            </div>
        </div>
        
        <!-- Raw AI Response (Collapsible) -->
        <div x-data="{ open: false }" class="mt-8 animate-fade-in-up" style="animation-delay: 0.5s">
            <button type="button" 
                    @click="open = !open" 
                    class="flex justify-between w-full px-4 py-3 text-sm font-medium text-left text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus-visible:ring focus-visible:ring-indigo-500 focus-visible:ring-opacity-50 transition-colors duration-200">
                <span>{{ $isFrench ? 'Voir la réponse brute de l\'IA' : 'View raw AI response' }}</span>
                <svg class="h-5 w-5 transform transition-transform duration-200" :class="{'rotate-180': open}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div x-show="open" 
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 transform scale-95"
                 x-transition:enter-end="opacity-1 transform scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-1 transform scale-100"
                 x-transition:leave-end="opacity-0 transform scale-95"
                 class="mt-2 bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-auto max-h-96">
                <pre class="text-xs text-gray-700 whitespace-pre-wrap">{{ $raw_response }}</pre>
            </div>
        </div>
        
        <!-- Additional Actions -->
        <div class="mt-8 flex flex-col md:flex-row justify-center space-y-3 md:space-y-0 md:space-x-3 animate-fade-in-up" style="animation-delay: 0.6s">
            <a href="{{ route('sherlock.recipes.create') }}" 
               class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                {{ $isFrench ? 'Générer une autre recette' : 'Generate another recipe' }}
            </a>
        </div>
    </div>
</div>

<!-- Mobile-First Styles and Animations -->
<style>
/* Print Styles */
@media print {
    nav, header, footer, .hidden-print, button {
        display: none !important;
    }
    
    body {
        background: white !important;
        font-size: 12pt;
        color: black !important;
    }
    
    .bg-white {
        background: white !important;
        box-shadow: none !important;
    }
    
    .container {
        max-width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
    }
}

/* Animations */
@keyframes fade-in {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fade-in-up {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes scale-in {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

.animate-fade-in {
    animation: fade-in 0.6s ease-out;
}

.animate-fade-in-up {
    animation: fade-in-up 0.8s ease-out;
    opacity: 0;
    animation-fill-mode: forwards;
}

.animate-scale-in {
    animation: scale-in 0.5s ease-out;
}

.delay-100 { animation-delay: 0.1s; }

/* Mobile Responsive */
@media (max-width: 768px) {
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    /* Mobile grid adjustments */
    .md\:grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    .md\:grid-cols-4 {
        grid-template-columns: repeat(2, 1fr);
    }
    
    /* Mobile text adjustments */
    .text-2xl {
        font-size: 1.5rem;
    }
    
    .text-xl {
        font-size: 1.25rem;
    }
    
    /* Touch-friendly elements */
    button, a {
        min-height: 44px;
        touch-action: manipulation;
    }
}

/* Enhanced hover effects */
.hover\:scale-105:hover {
    transform: scale(1.05);
}

/* Alpine.js loading state */
[x-cloak] { display: none !important; }
</style>

<!-- Include Alpine.js for collapsible functionality -->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
@endsection
